name: 🌹 Requirements Validation

on:
  workflow_dispatch:  # Manual trigger
  push:
    branches: [ main ]
    paths:
      - 'requirements/**'
      - 'schema/**'

jobs:
  validate-requirements:
    name: 📊 Validate Requirements
    runs-on: ubuntu-latest
    
    steps:
      - name: 📥 Checkout System Repository
        uses: actions/checkout@v4
      
      - name: 🔧 Setup jq
        run: sudo apt-get update && sudo apt-get install -y jq
      
      - name: 🔧 Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 18
      
      - name: 📦 Install ajv-cli for JSON Schema validation
        run: npm install -g ajv-cli
        
      - name: 🔍 Validate JSON-LD Requirements Format
        run: |
          if [ -f "requirements/requirements.jsonld" ]; then
            # Validate JSON-LD format
            jq empty requirements/requirements.jsonld
            echo "System requirements validation successful"
          else
            echo "Error: system requirements.jsonld not found"
            exit 1
          fi
          
          if [ -f "requirements/context/requirements-context.jsonld" ]; then
            # Validate context schema
            jq empty requirements/context/requirements-context.jsonld
            echo "Requirements context validation successful"
          else
            echo "Error: requirements-context.jsonld not found"
            exit 1
          fi
      
      - name: 🌟 Validate Against JSON Schema
        run: |
          if [ -f "schema/requirements-schema.json" ]; then
            ajv validate -s schema/requirements-schema.json -d requirements/requirements.jsonld
            echo "Schema validation successful"
          else
            echo "Warning: requirements-schema.json not found, skipping schema validation"
          fi
      
      # Note: This workflow will be enhanced incrementally as we implement components
      # Additional build, test, and compliance steps will be added as we develop actual code 